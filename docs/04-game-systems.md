# 04. κ²μ„ μ‹μ¤ν…

## ν„΄ μ‹μ¤ν…

- **ν„΄ μ ν•**: 120ν„΄ (`TURN_LIMIT`)
- ν„΄λ§λ‹¤ 3-Phase νμ μ‹μ¤ν… μ‹¤ν–‰

### ν„΄ μ§„ν–‰ β€” 3-Phase νμ μ‹μ¤ν…

```
Phase 1: λ³΄κ³  (μλ™, API 1ν)
  β”β”€ buildPhase1And3Prompt() β†’ callCouncilLLM()
  β”β”€ μƒνƒ λ³΄κ³ (status_reports) + κ³„ν λ³΄κ³ (plan_reports) ν• λ²μ— μƒμ„±Β·ν‘μ‹
  β””β”€ state_changes μ μ© (LLM λ¨λ“)

Phase 2: ν† λ΅  (AP 1 μ†λΉ„/λ°μ–Έ, API 0~Nν)
  β”β”€ μ°Έλ¨ λ°μ–Έ ν΄λ¦­ β†’ μ“°λ λ“ λ€ν™” (μ§€μ • μ°Έλ¨ μ°μ„  μ‘λ‹µ)
  β”β”€ μμ  μ…λ ¥ β†’ AI λ°μ‘ (callReactionLLM)
  β”β”€ κ³„ν μΉμΈ/κ±°μ : κ° μ°Έλ¨ λ§μ§€λ§‰ λ©”μ‹μ§€ ν•λ‹¨ λ²„νΌμΌλ΅ μ²λ¦¬
  β”‚   β”β”€ μΉμΈ: κΈ°λ΅λ§ (μ—΄μ • +1), μ‹¤μ  λ³€λ™μ€ Phase 3 μ‹μ‘ μ‹ μ μ©
  β”‚   β”β”€ κ±°μ : μ—΄μ • -1, μ°Έλ¨ μ‘λ‹µ ν…ν”λ¦Ώ
  β”‚   β””β”€ λ¬΄μ‹(μ•„λ¬΄κ²ƒλ„ μ• ν•¨): Phase 3 μ‹μ‘ μ‹ μ—΄μ • -2 ν¨λ„ν‹°
  β””β”€ "μ‹¤ν–‰" λ²„νΌ β†’ Phase 3

Phase 3: μ‹¤ν–‰ (μλ™)
  β”β”€ μΉμΈλ μ•κ±΄ μΌκ΄„ μ μ© (ν¬μΈνΈ λ³€λ™ + μ‹μ„¤ λ³€λ™)
  β”β”€ λ¬΄μ‹λ μ•κ±΄ ν¨λ„ν‹° μ μ© (μ—΄μ • -2)
  β”β”€ NPC ν„΄ (API 1ν, λ°°μΉ μ²λ¦¬)
  β”β”€ advanceWorldTurn(): ν¬μΈνΈ μ¶©μ „, λ¶€μƒ νλ³µ
  β”β”€ checkGameEnd(): μΉν¨ νμ •
  β”β”€ autoSave(): Firebase μλ™ μ €μ¥
  β””β”€ Phase 1 λ³µκ·€ (λ‹¤μ νμ μ‹μ‘ μ‹ "β… μ§€λ‚ νμ κ²°μ • λ°μ" μ„λ¨Έλ¦¬ ν‘μ‹)
```

> `MeetingPhase` νƒ€μ…μ€ `1 | 2 | 3`. `CouncilMessage.phase`λ” `1 | 2 | 3 | 4` (λ κ±°μ‹ νΈν™).
> μμ„Έν• λ‚΄μ©: `docs/11-case-system.md`

---

## μ°Έλ¨ μ‹μ¤ν… (Phase 1~4)

### 4μΈ μ°Έλ¨

| μ°Έλ¨ | μ—­ν•  | μ•„μ΄μ½ | μ„±κ²© |
|------|------|--------|------|
| μ κ°λ‰ | μ „λµ | π¶ | μ‹ μ¤‘, μ „λµμ , μ΅΄λ“λ§, κ³ μ‚¬ μΈμ©, μ¤ν‚¬/μ¥κΈ° μ „λµ λ‹΄λ‹Ή |
| κ΄€μ° | κµ°μ‚¬ | β”οΈ | λ…μ, μ§μ„¤μ , κµ°μ‚¬μ  ν•΄κ²° μ„ νΈ, μ§•λ³‘/ν›λ ¨/μ „ν¬ λ‹΄λ‹Ή |
| λ°©ν†µ | μ™Έκµ | π¦… | μλ¶€μ‹¬, κ³„λµμ— λ¥ν•¨, μ™Έκµ μ „λµκ³Ό μ΄κ°„κ³„, λ™λ§Ή λ‹΄λ‹Ή |
| λ―Έμ¶• | λ‚΄μ • | π’° | λ³΄μμ , κ²½μ  μ¤‘μ‹, μμΉ κ·Όκ±°, μ¬μ •/μ‹μ„¤ κ΄€λ¦¬ λ‹΄λ‹Ή |

### μ°Έλ¨ μƒνƒ

- **μ¶©μ„±λ„** (loyalty, 0~100): μ°Έλ¨μ μ£Όκ³µμ— λ€ν• μ¶©μ„±μ‹¬
- **μ—΄μ •** (enthusiasm, 0~100): μ—…λ¬΄ μμ•, ν–‰λ™ ν’μ§μ— μν–¥
- λ§¤ ν„΄ AIκ°€ `advisor_updates`λ΅ λ³€λ™κ°’ λ°ν™

### μ“°λ λ“ λ€ν™”

- μ°Έλ¨ λ°μ–Έμ„ ν΄λ¦­ν•λ©΄ ν•΄λ‹Ή μ£Όμ λ΅ μ“°λ λ“ λ€ν™” μ‹μ‘
- μ“°λ λ“ λ‚΄ λ‹µμ¥: μ§€μ •λ μ°Έλ¨κ°€ **λ¨Όμ €** μ‘λ‹µ (ν”„λ΅¬ν”„νΈ + μ½”λ“ λ λ²¨ κ°•μ )
- λ‹¤λ¥Έ μ°Έλ¨μ μ²¨μ–Έμ€ μ΄ν›„μ— λ”°λΌμ΄
- `Record<number, ThreadMessage[]>` κµ¬μ΅° (λ©”μ‹μ§€ μΈλ±μ¤ β†’ μ“°λ λ“)

---

## ν¬μΈνΈ μ‹μ¤ν…

### 5μΆ… ν¬μΈνΈ

| ν¬μΈνΈ | μ•½μΉ­ | μ„¤λ… | μ¶©μ „/μ†λΉ„ |
|--------|------|------|-----------|
| ν–‰λ™ ν¬μΈνΈ | AP | λ°μ–Έ κΈ°ν | λ§¤ν„΄ μ΄μ›”(50%) + μ¶©μ „ |
| μ „λµ ν¬μΈνΈ | SP | μ¤ν‚¬ νΈλ¦¬ ν•΄κΈ | λ§¤ν„΄ μ†λ‰ μλ™ μ¶©μ „ |
| κµ°μ‚¬ ν¬μΈνΈ | MP | μ „ν¬λ ¥ = troops Γ— training Γ— morale | λ¨λ³‘/ν›λ ¨μΌλ΅ μ¦κ°€ |
| λ‚΄μ • ν¬μΈνΈ | IP | μ‹μ„¤/λ¨λ³‘/ν›λ ¨ λΉ„μ© | μ‹μ„¤ λ λ²¨ κΈ°λ° μ¶©μ „ (μƒν• μ΅΄μ¬) |
| μ™Έκµ ν¬μΈνΈ | DP | μ™Έκµ ν–‰λ™ λΉ„μ© | λ§¤ν„΄ μ†λ‰ μλ™ μ¶©μ „ |

### AP μ΄μ›”

- λ§¤ν„΄ AP = `floor(μ΄μ „ AP Γ— 0.5) + ap_regen`
- APκ°€ ap_maxλ¥Ό μ΄κ³Όν•μ§€ μ•μ

### MP μ‚°μ¶

```
MP = mp_troops Γ— mp_training Γ— mp_morale
```

- `mp_troops`: λ³‘λ ¥ μ (λ¨λ³‘μΌλ΅ μ¦κ°€, μ „ν¬λ΅ κ°μ†)
- `mp_training`: ν›λ ¨λ„ (0.0~1.0, IPλ΅ ν›λ ¨)
- `mp_morale`: μ‚¬κΈ° (0.8~1.2, μΉλ¦¬/ν¨λ°°λ΅ λ³€λ™)

### IP μ‹μ„¤ κΈ°λ°

- λ§¤ν„΄ IP μ¶©μ „: `market_level Γ— 3 + farm_level Γ— 2`
- IP μƒν•: `ip_cap` (μ€ν–‰ λ λ²¨λ΅ μ¦κ°€)
- μ‹μ„¤ μ—…κ·Έλ μ΄λ“ λΉ„μ©: `level Γ— BASE_FACILITY_COST`

### DP μλ™ μ¶©μ „

- λ§¤ν„΄ DP +1 μλ™ μ¶©μ „
- `dp_bonus` μ¤ν‚¬λ΅ μ¶©μ „ ν¨μ¨ μ¦κ°€

### κ²½ν—μΉ μ‹μ¤ν…

> μƒμ: `gameConstants.ts`

| ν•­λ© | κ°’ | μ„¤λ… |
|------|------|------|
| BASE_XP_TO_LEVEL | 100 | λ λ²¨μ—… ν•„μ” κ²½ν—μΉ κΈ°λ³Έκ°’ |
| XP_PER_AP_SPENT | 15 | AP 1 μ†λΉ„ μ‹ κ²½ν—μΉ νλ“ |
| SP_PER_BATTLE_WIN | 5 | μ „ν¬ μΉλ¦¬ μ‹ SP νλ“ |

- APλ¥Ό μ†λΉ„(Phase 2/4 λ°μ–Έ)ν•  λ•λ§λ‹¤ κ²½ν—μΉ νλ“
- λ λ²¨μ—… μ‹ `deploymentCap` μ¦κ°€ (`level Γ— 30,000`)

---

## μ „ν¬ μ‹μ¤ν…

> νμΌ: `lib/game/combatSystem.ts`

### μ „ν¬ μ ν•

| μ ν• | μ„¤λ… | κ³µκ²©μΈ΅ λ°°μ¨ | μλΉ„μΈ΅ λ°°μ¨ |
|------|------|------------|------------|
| μ•Όμ „ | ν‰μ§€ μ „ν¬ | 1.0 | 1.0 |
| κ³µμ„± | μ„±μ±„ κ³µκ²© | 1.0 (+μ¤ν‚¬) | μ„±μ±„ λ°©μ–΄ λ°°μ¨ |
| μμ„± | μ„±μ±„ λ°©μ–΄ | 1.0 | μ„±μ±„ λ°©μ–΄ λ°°μ¨ (+μ¤ν‚¬) |

### μ „ν¬λ ¥ κ³„μ‚°

```
μ „ν¬λ ¥ = MP Γ— λ°©μ–΄ λ°°μ¨
κ³µκ²©μΈ΅ μ „ν¬λ ¥ - μλΉ„μΈ΅ μ „ν¬λ ¥ β†’ μ–‘μλ©΄ κ³µκ²©μΈ΅ μΉλ¦¬
Β±10% λλ¤ λ³€λ™ μ μ©
```

### λ°°μΉ μƒν•

- `rulerLevel.deploymentCap` = level Γ— 30,000
- ν¬μ… λ³‘λ ¥μ΄ λ°°μΉ μƒν•μ„ μ΄κ³Όν•  μ μ—†μ

### μ „ν¬ κ²°κ³Ό

- μ†μ‹¤λ¥ : κΈ°λ³Έ 20%, μµλ€ 50%
- λ¶€μƒ μ „ν™: μ‚¬λ§μμ 70%κ°€ λ¶€μƒλ³‘μΌλ΅ μ „ν™
- λ¶€μƒ νλ³µ: `WOUND_RECOVERY_TURNS` (5ν„΄)μ— κ±Έμ³ λ³‘λ ¥ λ³µκ·€
- μ„±μ±„ μ λ Ή: **κ³µμ„±** μΉλ¦¬ μ‹λ§ ν•΄λ‹Ή μ„±μ±„ μ†μ κ¶ μ΄μ „

---

## μ™Έκµ μ‹μ¤ν…

> νμΌ: `lib/game/diplomacySystem.ts`

### κ΄€κ³„ μ μ

-10 ~ +10 μ¤μΌ€μΌ. `scoreToLabel()`λ΅ λ³€ν™:

| μ μ λ²”μ„ | λΌλ²¨ |
|-----------|------|
| 7 μ΄μƒ | λ™λ§Ή |
| 3 ~ 6 | μ°νΈ |
| -3 ~ 2 | μ¤‘λ¦½ |
| -7 ~ -4 | μ λ€ |
| -8 μ΄ν• | μ „μ |

### μ™Έκµ ν–‰λ™

DPλ¥Ό μ†λΉ„ν•μ—¬ κ΄€κ³„ λ³€λ™. AIκ°€ μ™Έκµ ν–‰λ™μ„ μ μ•/μ‹¤ν–‰.

---

## μ„±μ±„ μ‹μ¤ν…

> νμΌ: `constants/castles.ts`

### λ°°μΉ κµ¬μ΅°

~34κ° μ„±μ±„κ°€ μ‚Όκ°ν• λΌμΈμΌλ΅ λ°°μΉ:

```
μ λΉ„(μ‹ μ•Ό) β†β”€β”€ liu_cao λΌμΈ β”€β”€β†’ μ΅°μ΅°(ν—μ°½)
  β†“                                β†‘
liu_sun λΌμΈ               sun_cao λΌμΈ
  β†“                                β†‘
μ†κ¶(κ±΄μ—…) β†β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μ„±μ±„ λ“±κΈ‰

| λ“±κΈ‰ | λ°©μ–΄ λ°°μ¨ | μμ‹ |
|------|-----------|------|
| λ³Έμ„± | 3.0 | μ‹ μ•Ό, ν—μ°½, κ±΄μ—… |
| μ”μƒ | 2.0~2.5 | μ–‘μ–‘, μ—…, ν•©λΉ„, κ°•λ¦‰ |
| μΌλ° | 1.5 | μ™„, μ„μ£Ό, μ§„λ¥ λ“± |

### μ΄κΈ° μ„Έλ ¥ μν† 

| μ„Έλ ¥ | μ„±μ±„ μ | λ³Έμ„± |
|------|---------|------|
| μ λΉ„ | 2 | μ‹ μ•Ό |
| μ΅°μ΅° | 24 | ν—μ°½ |
| μ†κ¶ | 9 | κ±΄μ—… |

---

## μ¤ν‚¬ μ‹μ¤ν…

> νμΌ: `constants/skills.ts`

SPλ¥Ό μ†λΉ„ν•μ—¬ μκµ¬ ν¨μ‹λΈ ν¨κ³Ό ν•΄κΈ.

| μΉ΄ν…κ³ λ¦¬ | ν¨κ³Ό μμ‹ |
|----------|----------|
| AP κ³„μ—΄ | AP μλ™ μ¶©μ „ μ¦κ°€ |
| MP κ³„μ—΄ | λ§¤ν„΄ λ³‘λ ¥ μλ™ μ¦κ°€ |
| IP κ³„μ—΄ | IP μ¶©μ „λ‰ λ³΄λ„μ¤ |
| μ „ν¬ κ³„μ—΄ | κ³µμ„±/μμ„± λ²„ν”„ |

μ„ ν–‰ μ¤ν‚¬ μ΅°κ±΄: `prerequisites` μ¶©μ΅± ν•„μ”.

---

## μΉλ¦¬/ν¨λ°° μ΅°κ±΄

> νμΌ: `lib/game/victorySystem.ts`

### μΉλ¦¬

| μ΅°κ±΄ | μ„¤λ… |
|------|------|
| μ²ν•ν†µμΌ | λ¨λ“  μ  μ„Έλ ¥μ **λ³Έμ„±** ν•¨λ½ |

### ν¨λ°°

| μ΅°κ±΄ | μ„¤λ… |
|------|------|
| λ©Έλ§ | μκΈ° **λ³Έμ„±** ν•¨λ½λ¨ |

λ³Έμ„± λ©λ΅: μ λΉ„=μ‹ μ•Ό, μ΅°μ΅°=ν—μ°½, μ†κ¶=κ±΄μ—… (`CAPITAL_CASTLES`)
