# 02. 게임플레이 확장 상세 계획 ✓ 완료

## 목표

리팩토링된 코드베이스 위에 다수 군주 AI 시스템, 전투, 외교, 세이브/로드, 승리/패배 조건을 추가하여 본격적인 전략 게임으로 확장한다.

## C.1: 다수 군주 시스템 (최우선)

### 핵심 변경
- `GameState` → `WorldState` (다수 세력 포함)
- Faction 인터페이스: id, rulerName, isPlayer, 자원, 도시, 장수, 성격
- DiplomaticRelation: 세력 간 관계

### 초기 세력
- 유비 (플레이어): 신야/하비, 8천 병력
- 조조: 허창/업/낙양, 15만 병력
- 손권: 건업/시상, 8만 병력
- 원소: 남피/기주, 11만 병력

### 영토 맵
- 도시 간 인접 관계, 지형(평원/산지/강/요새), 방어 보너스

### 턴 시스템
- 플레이어 턴: 참모 보고 → 선택 → 결과
- NPC 턴: AI 행동 결정 → 결과 → 플레이어에게 요약
- NPC 결정 배치 처리 (API 비용 최적화)

### 새 UI
- WorldStatus.tsx, FactionBanner.tsx, TurnNotification.tsx

## C.2: 전투 시스템

- 전투력 계산: 장수 능력치 + 병력 + 지형
- 전투 종류: 야전, 공성전, 매복
- 결과: 승패, 피해, 포로, 영토 변화
- BattleReport.tsx로 드라마틱 표시

## C.3: 외교 시스템

- 관계: 동맹/우호/중립/적대/전쟁 (-100~100)
- 외교 행동: 동맹 제안, 교역, 불가침 조약, 선전포고
- DiplomacyPanel.tsx: 관계 매트릭스, 외교 버튼

## C.4: 세이브/로드

- localStorage 5슬롯 + 자동 저장
- SaveData: version, timestamp, worldState, chatMessages, convHistory
- SaveLoadPanel.tsx + TitleScreen에 이어하기 버튼

## C.5: 승리/패배 조건

- 승리: 천하통일 (전체 도시) 또는 천명 (70% 도시 + 민심 90)
- 패배: 멸망 (도시 0) 또는 파산 (자원 모두 0)
- GameEndScreen.tsx

## 의존성 순서

```
C.1 (다수 군주) → C.2 (전투) → C.5 (승리/패배)
       ↓
    C.3 (외교)
       ↓
    C.4 (세이브/로드) — C.1 이후 언제든 가능
```

## 리스크 대응

| 리스크 | 대응 |
|--------|------|
| API 비용 증가 | NPC 배치 처리 + 로컬 로직 대체 |
| 턴 처리 지연 | 프로그레스 UI + 병렬 처리 |
| localStorage 한계 | 대화 기록 20개 제한 |
| AI JSON 파싱 실패 | regex fallback + 기본값 |
| 게임 밸런스 | 난이도 설정 + 시나리오 시작점 |
